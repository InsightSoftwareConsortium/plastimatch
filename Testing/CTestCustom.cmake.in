SET (BROOK_FOUND @BROOK_FOUND@)
SET (CMAKE_Fortran_COMPILER_WORKS @CMAKE_Fortran_COMPILER_WORKS@)
SET (CUDA_FOUND @CUDA_FOUND@)
SET (FFTW_FOUND @FFTW_FOUND@)
SET (PLM_PLASTIMATCH_PATH "@PLM_PLASTIMATCH_PATH@")
SET (PLM_PLASTIMATCH_PATH_HACK "@PLM_PLASTIMATCH_PATH_HACK@")
SET (PLM_REDUCED_TESTS @PLM_REDUCED_TESTS@)
SET (PLM_TEST_BSPLINE_FLAVORS @PLM_TEST_BSPLINE_FLAVORS@)
SET (PLM_TEST_DICOM @PLM_TEST_DICOM@)
SET (PLM_TESTING_BUILD_DIR "@PLM_TESTING_BUILD_DIR@")
SET (OPENCL_FOUND @OPENCL_FOUND@)

## If we don't have functioning CUDA, don't run CUDA tests
SET (RUN_CUDA_TESTS OFF)
IF (CUDA_FOUND)
  EXECUTE_PROCESS (COMMAND 
    "${PLM_PLASTIMATCH_PATH}/cuda_probe"
    RESULT_VARIABLE CUDA_PROBE_RESULT
    OUTPUT_VARIABLE CUDA_PROBE_STDOUT
    ERROR_VARIABLE CUDA_PROBE_STDERR
    )
  FILE (WRITE "${PLM_TESTING_BUILD_DIR}/cuda_probe_result.txt"
    "${CUDA_PROBE_RESULT}")
  FILE (WRITE "${PLM_TESTING_BUILD_DIR}/cuda_probe_stdout.txt"
    "${CUDA_PROBE_STDOUT}")
  FILE (WRITE "${PLM_TESTING_BUILD_DIR}/cuda_probe_stderr.txt"
    "${CUDA_PROBE_STDERR}")
  STRING (REGEX MATCH "NOT cuda capable" CUDA_PROBE_NOT_CAPABLE
    "${CUDA_PROBE_STDOUT}")
  IF (NOT CUDA_PROBE_RESULT AND NOT CUDA_PROBE_NOT_CAPABLE)
    SET (RUN_CUDA_TESTS ON)
  ENDIF ()
ENDIF ()

## If we don't have functioning OpenCL, don't run OpenCL tests
SET (RUN_OPENCL_TESTS OFF)
IF (OPENCL_FOUND)
  EXECUTE_PROCESS (COMMAND 
    "${PLM_PLASTIMATCH_PATH}/opencl_probe"
    RESULT_VARIABLE OPENCL_PROBE_RESULT
    OUTPUT_VARIABLE OPENCL_PROBE_STDOUT
    ERROR_VARIABLE OPENCL_PROBE_STDERR
    )
  FILE (WRITE "${PLM_TESTING_BUILD_DIR}/opencl_probe_result.txt"
    "${OPENCL_PROBE_RESULT}")
  FILE (WRITE "${PLM_TESTING_BUILD_DIR}/opencl_probe_stdout.txt"
    "${OPENCL_PROBE_STDOUT}")
  FILE (WRITE "${PLM_TESTING_BUILD_DIR}/opencl_probe_stderr.txt"
    "${OPENCL_PROBE_STDERR}")
  STRING (REGEX MATCH "Opencl does not work" OPENCL_PROBE_NOT_CAPABLE
    "${OPENCL_PROBE_STDOUT}")
  IF (NOT OPENCL_PROBE_RESULT AND NOT OPENCL_PROBE_NOT_CAPABLE)
    SET (RUN_OPENCL_TESTS ON)
  ENDIF ()
ENDIF ()

# drr-d doen't work yet
SET (CTEST_CUSTOM_TESTS_IGNORE
  ${CTEST_CUSTOM_TESTS_IGNORE}
  "drr-d"
  "drr-d-stats"
  "drr-d-check"
  )

## If we don't have a fortran compiler, don't test bragg_curve
IF (NOT CMAKE_Fortran_COMPILER_WORKS)
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "bragg-curve"
    "bragg-curve-check"
    )
ENDIF ()

## If we didn't get XiO dicom-rt test data, don't run these tests
IF (NOT EXISTS "${PLM_TESTING_BUILD_DIR}/chest-phantom-dicomrt-xio-4.33.02")
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "plm-convert-dicom-a"
    "plm-convert-dicom-a-stats"
    "plm-convert-dicom-a-check"
    "plm-convert-dicom-b"
    "plm-convert-dicom-b-stats"
    "plm-convert-dicom-b-check"
    "plm-convert-dicom-c"
    "plm-convert-dicom-c-stats"
    "plm-convert-dicom-c-check"
    "plm-convert-dicom-d"
    "plm-convert-dicom-d-stats"
    "plm-convert-dicom-d-check"
    "plm-convert-dicom-e"
    "plm-convert-dicom-f"
    "plm-convert-dicom-f-stats"
    "plm-convert-dicom-f-check"
    "plm-convert-dicom-g"
    "plm-convert-dicom-xio-a"

    "plm-convert-cxt"
    "plm-convert-cxt-stats"
    "plm-convert-cxt-check"
    )
ENDIF ()

## If we didn't get xio test data, don't run xio tests
IF (NOT EXISTS "${PLM_TESTING_BUILD_DIR}/chest-phantom-xio-4.33.02")
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "plm-convert-xio"
    "plm-convert-xio-stats"
    "plm-convert-xio-check"
    "plm-warp-e"
    "plm-warp-e-stats-1"
    "plm-warp-e-check-1"
    "plm-warp-e-stats-2"
    "plm-warp-e-check-2"
    "plm-warp-e-stats-3"
    "plm-warp-e-check-3"
    "plm-warp-e-stats-4"
    "plm-warp-e-check-4"
    "plm-warp-e-check-5"
    "plm-warp-e-check-6"
    "plm-warp-f"
    "plm-warp-f-stats-1"
    "plm-warp-f-check-1"
    "plm-warp-f-stats-2"
    "plm-warp-f-check-2"
    )
ENDIF ()

IF (NOT EXISTS "${PLM_TESTING_BUILD_DIR}/foot-dicomrt-aw-4.4")
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "plm-convert-dicom-aw-a" 
    "plm-convert-dicom-aw-a-stats" 
    "plm-convert-dicom-aw-b" 
    )
ENDIF ()

IF (NOT EXISTS "${PLM_TESTING_BUILD_DIR}/chest-phantom-dicomrt-CERR4pt0beta2_25_Jan_2011")
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "plm-convert-dicom-cerr-a" 
    )
ENDIF ()

IF (NOT EXISTS "${PLM_TESTING_BUILD_DIR}//rando-dicomrt-pinnacle3-8.2g")
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "plm-convert-dicom-pinnacle-a" 
    )
ENDIF ()

## If we didn't get varian fdk test data, don't run these tests
IF (NOT EXISTS "${PLM_TESTING_BUILD_DIR}/varian-catphan")
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "fdk-cpu-b"
    "fdk-cpu-b-stats"
    "fdk-cpu-b-check"
    "fdk-cpu-c"
    "fdk-cpu-c-stats"
    "fdk-cpu-c-check"
    )
ENDIF ()

## If we don't have fftw, don't run these tests
IF (NOT FFTW_FOUND)
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "fdk-cpu-c"
    "fdk-cpu-c-stats"
    "fdk-cpu-c-check"
    )
ENDIF ()

## If we didn't compile with cuda, don't run these tests
IF (NOT RUN_CUDA_TESTS)
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "demons-cuda-a"
    "demons-cuda-a-check"
    "drr-cuda"
    "drr-cuda-stats"
    "drr-cuda-check"
    "fdk-cuda-a"
    "fdk-cuda-a-stats"
    "fdk-cuda-a-check"
    "plm-bspline-cuda" 
    "plm-bspline-cuda-stats" 
    "plm-bspline-cuda-check" 
    )
ENDIF ()

## If we didn't compile with opencl, don't run these tests
IF (NOT RUN_OPENCL_TESTS)
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "drr-opencl"
    "drr-opencl-stats"
    "drr-opencl-check"
    "fdk-opencl-a"
    "fdk-opencl-a-stats"
    "fdk-opencl-a-check"
    ) 
ENDIF ()

## If we didn't compile with brook, don't run these tests
IF (NOT BROOK_FOUND)
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "fdk-brook"
    "fdk-brook-stats"
    "fdk-brook-check"
    )
ENDIF ()

## Don't test unused algorithms
IF (NOT PLM_TEST_BSPLINE_FLAVORS)
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "bspline-a"
    "bspline-a-check"
    "bspline-b"
    "bspline-b-check"
    "bspline-d"
    "bspline-d-check"
    "bspline-e"
    "bspline-e-check"
    "bspline-f"
    "bspline-f-check"
    )
ENDIF ()

## Don't delete from the list, comment out instead.
IF (PLM_REDUCED_TESTS)
  SET (CTEST_CUSTOM_TESTS_IGNORE
    ${CTEST_CUSTOM_TESTS_IGNORE}
    "gauss-1"
    "gauss-2"
    "gauss-3"
    "gauss-4"
    "gauss-5"
    "gauss-6"
    "gauss-ushort-1"
    "gauss-ushort-2"
    "rect-1"
    "rect-2"
    "rect-3"
    "sphere-1"
    "bspline-bxf"
    "bspline-bxf-check"
    "bspline-a"
    "bspline-a-check"
    "bspline-b"
    "bspline-b-check"
    "bspline-c"
    "bspline-c-check"
    "bspline-d"
    "bspline-d-check"
    "bspline-e"
    "bspline-e-check"
    "bspline-f"
    "bspline-f-check"
    "bspline-g"
    "bspline-g-check"
    "bspline-h"
    "bspline-h-check"
    "bspline-mi-c-1"
    "bspline-mi-c-1-check"
    "bspline-mi-c-2"
    "bspline-mi-c-2-check"

    "demons-a"
    "demons-a-check"
    "demons-cuda-a"
    "demons-cuda-a-check"

    "drr-a"
    "drr-a-stats"
    "drr-a-check"
    "drr-b"
    "drr-b-stats"
    "drr-b-check"
    "drr-c"
    "drr-c-stats"
    "drr-c-check"
    "drr-cuda"
    "drr-cuda-stats"
    "drr-cuda-check"
    "drr-opencl"
    "drr-opencl-stats"
    "drr-opencl-check"

    "fdk-cpu-a"
    "fdk-cpu-a-stats"
    "fdk-cpu-a-check"
    "fdk-cpu-b"
    "fdk-cpu-b-stats"
    "fdk-cpu-b-check"
    "fdk-cpu-c"
    "fdk-cpu-c-stats"
    "fdk-cpu-c-check"
    "fdk-cuda-a"
    "fdk-cuda-a-stats"
    "fdk-cuda-a-check"
    "fdk-opencl-a"
    "fdk-opencl-a-stats"
    "fdk-opencl-a-check"

    "landmark-warp-a"
    "landmark-warp-a-stats-1"
    "landmark-warp-a-check-1"
    "landmark-warp-a-stats-2"
    "landmark-warp-a-check-2"
    "landmark-warp-b"
    "landmark-warp-b-stats-1"
    "landmark-warp-b-check-1"
    "landmark-warp-b-stats-2"
    "landmark-warp-b-check-2"
    "landmark-warp-c"
    "landmark-warp-c-stats-1"
    "landmark-warp-c-check-1"
    "landmark-warp-c-stats-2"
    "landmark-warp-c-check-2"

    "plm-convert-dicom-a"
    "plm-convert-dicom-a-stats"
    "plm-convert-dicom-a-check"
    "plm-convert-dicom-b"
    "plm-convert-dicom-b-stats"
    "plm-convert-dicom-b-check"
    "plm-convert-dicom-c"
    "plm-convert-dicom-c-stats"
    "plm-convert-dicom-c-check"
    "plm-convert-dicom-d"
    "plm-convert-dicom-d-stats"
    "plm-convert-dicom-d-check"
    "plm-convert-dicom-e"
    "plm-convert-dicom-f"
    "plm-convert-dicom-f-stats"
    "plm-convert-dicom-f-check"
    "plm-convert-dicom-g"

    "plm-convert-dicom-aw-a"
    "plm-convert-dicom-aw-a-stats"
    "plm-convert-dicom-aw-a-check"
    "plm-convert-dicom-aw-b"
    "plm-convert-dicom-cerr-a"
    "plm-convert-dicom-pinnacle-a"
    "plm-convert-dicom-xio-a"

    "plm-convert-cxt"
    "plm-convert-cxt-stats"
    "plm-convert-cxt-check"
    "plm-convert-xio"
    "plm-convert-xio-stats"
    "plm-convert-xio-check"

    "plm-usage" 

    "plm-register-align-center"
    "plm-register-align-center-stats"
    "plm-register-align-center-check"
    "plm-register-itk-translation"
    "plm-register-itk-translation-stats"
    "plm-register-itk-translation-check"
    "plm-register-itk-rigid"
    "plm-register-itk-rigid-stats-1"
    "plm-register-itk-rigid-check-1"
    "plm-register-itk-rigid-stats-2"
    "plm-register-itk-rigid-check-2"
    "plm-bspline-single-c"
    "plm-bspline-single-c-stats" 
    "plm-bspline-single-c-check" 
    "plm-bspline-single-h" 
    "plm-bspline-single-h-stats"
    "plm-bspline-single-h-check"
    "plm-bspline-openmp" 
    "plm-bspline-openmp-stats"
    "plm-bspline-openmp-check"
    "plm-bspline-cuda" 
    "plm-bspline-cuda-stats"
    "plm-bspline-cuda-check"
    "plm-register-bspline-ushort"
    "plm-register-bspline-ushort-stats"
    "plm-register-bspline-ushort-check"

    "plm-register-rect-bspline" 

    "plm-register-compose" 
    "plm-compose-a" 
    "plm-compose-a-warp" 
    "plm-compose-a-stats"
    "plm-compose-a-check"
    "plm-compose-b" 
    "plm-compose-b-warp" 
    "plm-compose-b-stats"
    "plm-compose-b-check"
    "plm-compose-c" 
    "plm-compose-c-warp" 
    "plm-compose-c-stats"
    "plm-compose-c-check"

    "plm-resample-a"

    "plm-warp-pointset-a" 
    "plm-warp-pointset-b" 

    "plm-warp-a"
    "plm-warp-a-stats"
    "plm-warp-a-check"
    "plm-warp-b"
    "plm-warp-b-stats-1"
    "plm-warp-b-check-1"
    "plm-warp-b-stats-2"
    "plm-warp-b-check-2"
    "plm-warp-c"
    "plm-warp-c-stats"
    "plm-warp-c-check"
    "plm-warp-d" 
    "plm-warp-d-stats"
    "plm-warp-d-check"
    "plm-warp-e" 
    "plm-warp-e-stats-1"
    "plm-warp-e-check-1"
    "plm-warp-e-stats-2"
    "plm-warp-e-check-2"
    "plm-warp-e-stats-3"
    "plm-warp-e-check-3"
    "plm-warp-e-stats-4"
    "plm-warp-e-check-4"
    "plm-warp-e-check-5"
    "plm-warp-e-check-6"
    "plm-warp-f" 
    "plm-warp-f-stats-1"
    "plm-warp-f-check-1"
    "plm-warp-f-stats-2"
    "plm-warp-f-check-2"
    "plm-warp-g" 
    "plm-warp-g-stats-1"
    "plm-warp-g-check-1"
    "plm-warp-h" 
    "plm-warp-h-stats-1"
    "plm-warp-h-check-1"

    "plm-drr-api-a"
    "plm-registration-api-a"

    "bragg-curve"
    "bragg-curve-check"
    "proton-dose"
    "tps-warp"
    "xf-to-xf-1"
    "xf-to-xf-2"
    "xf-to-xf-3"
    )
ENDIF (PLM_REDUCED_TESTS)
